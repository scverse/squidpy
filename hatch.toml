[envs.default]
installer = "uv"
features = ["dev"]

[envs.test]
features = ["test"]
extra-dependencies = [
    "pytest",
    "pytest-xdist", 
    "pytest-cov",
    "pytest-mock",
    "pytest-timeout",
]

[envs.test.scripts]
test = "python -m pytest --color=yes --cov --cov-append --cov-report=xml --cov-config=pyproject.toml --ignore docs/ {args:-vv}"

[envs.coverage]
extra-dependencies = [
    "coverage[toml]",
    "diff_cover",
]

[envs.coverage.scripts]
clean = "coverage erase"
report = "coverage report --omit='tox/*'"
xml = "coverage xml --omit='tox/*' -o coverage.xml"
diff = "diff-cover --compare-branch origin/main coverage.xml"

[envs.docs]
features = ["docs"]
extra-dependencies = [
    "setuptools",
]

[envs.docs.scripts]
build = "make -C docs html {args}"
clean = "make -C docs clean"
check = "make -C docs linkcheck {args}"

[envs.data]
[envs.data.scripts]
download = "python ./.scripts/ci/download_data.py {args}"


[envs.hatch-test]
features = ["test"]
extra-dependencies = [
    "pytest",
    "pytest-xdist", 
    "pytest-cov",
    "pytest-mock",
    "pytest-timeout",
]

overrides.matrix.deps.python = [
    { if = ["ubuntu"], value = ["3.11", "3.12", "3.13"] },
    { if = ["macos"], value = ["3.11"] },
]

[[envs.hatch-test.matrix]]
deps = ["ubuntu", "macos"]


[envs.hatch-test.scripts]
run = "python -m pytest --color=yes --cov --cov-append --cov-report=xml --cov-config=pyproject.toml --ignore docs/ {args:-vv}"
run-cov = "python -m pytest --color=yes --cov --cov-append --cov-report=xml --cov-config=pyproject.toml --ignore docs/ {args:-vv}"